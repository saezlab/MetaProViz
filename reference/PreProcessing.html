<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Modularised Normalization: 80%-filtering rule, total-ion count normalization, missing value imputation and Outlier Detection: HotellingT2. — PreProcessing • MetaProViz</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Modularised Normalization: 80%-filtering rule, total-ion count normalization, missing value imputation and Outlier Detection: HotellingT2. — PreProcessing"><meta name="description" content="Modularised Normalization: 80%-filtering rule, total-ion count normalization, missing value imputation and Outlier Detection: HotellingT2."><meta property="og:description" content="Modularised Normalization: 80%-filtering rule, total-ion count normalization, missing value imputation and Outlier Detection: HotellingT2."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetaProViz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-book-open"></span> Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="../articles/Standard%20Metabolomics.html">Standard Metabolomics</a></li>
    <li><a class="dropdown-item" href="../articles/CoRe%20Metabolomics.html">CoRe Metabolomics</a></li>
    <li><a class="dropdown-item" href="../articles/EnrichmentAnalysis.html">Enrichment Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Metadata%20Analysis.html">Metadata Analysis</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-solid fa-rocket"></span> Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/saezlab/MetaProViz"><span class="fa fa-brands fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://saezlab.org/"><span class="fa fas fa-university"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://frezza.cecad-labs.uni-koeln.de/home"><span class="fa fas fa-university"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Modularised Normalization: 80%-filtering rule, total-ion count normalization, missing value imputation and Outlier Detection: HotellingT2.</h1>
      <small class="dont-index">Source: <a href="https://github.com/saezlab/MetaProViz/blob/main/R/Processing.R" class="external-link"><code>R/Processing.R</code></a></small>
      <div class="d-none name"><code>PreProcessing.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Modularised Normalization: 80%-filtering rule, total-ion count normalization, missing value imputation and Outlier Detection: HotellingT2.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">PreProcessing</span><span class="op">(</span></span>
<span>  <span class="va">InputData</span>,</span>
<span>  <span class="va">SettingsFile_Sample</span>,</span>
<span>  <span class="va">SettingsInfo</span>,</span>
<span>  FeatureFilt <span class="op">=</span> <span class="st">"Modified"</span>,</span>
<span>  FeatureFilt_Value <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  TIC <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  MVI <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  MVI_Percentage <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  HotellinsConfidence <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  CoRe <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  SaveAs_Plot <span class="op">=</span> <span class="st">"svg"</span>,</span>
<span>  SaveAs_Table <span class="op">=</span> <span class="st">"csv"</span>,</span>
<span>  PrintPlot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  FolderPath <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-inputdata">InputData<a class="anchor" aria-label="anchor" href="#arg-inputdata"></a></dt>
<dd><p>DF which contains unique sample identifiers as row names and metabolite numerical values in columns with metabolite identifiers as column names. Use NA for metabolites that were not detected.</p></dd>


<dt id="arg-settingsfile-sample">SettingsFile_Sample<a class="anchor" aria-label="anchor" href="#arg-settingsfile-sample"></a></dt>
<dd><p>DF which contains information about the samples, which will be combined with the input data based on the unique sample identifiers used as rownames.</p></dd>


<dt id="arg-settingsinfo">SettingsInfo<a class="anchor" aria-label="anchor" href="#arg-settingsinfo"></a></dt>
<dd><p>Named vector containing the information about the names of the experimental parameters. c(Conditions="ColumnName_Plot_SettingsFile", Biological_Replicates="ColumnName_Plot_SettingsFile"). Column "Conditions" with information about the sample conditions (e.g. "N" and "T" or "Normal" and "Tumor"), can be used for feature filtering and colour coding in the PCA. Column "BiologicalReplicates" including numerical values. For CoRe = TRUE a CoRe_norm_factor = "Columnname_Input_SettingsFile" and CoRe_media = "Columnname_Input_SettingsFile", have to also be added. Column CoRe_norm_factor is used for normalization and CoRe_media is used to specify the name of the media controls in the Conditions.</p></dd>


<dt id="arg-featurefilt">FeatureFilt<a class="anchor" aria-label="anchor" href="#arg-featurefilt"></a></dt>
<dd><p><em>Optional: </em>If NULL, no feature filtering is performed. If set to "Standard" then it applies the 80%-filtering rule (Bijlsma S. et al., 2006) on the metabolite features on the whole dataset. If is set to "Modified",filtering is done based on the different conditions, thus a column named "Conditions" must be provided in the Input_SettingsFile input file including the individual conditions you want to apply the filtering to (Yang, J et al., 2015). <strong>Default = "Standard"</strong></p></dd>


<dt id="arg-featurefilt-value">FeatureFilt_Value<a class="anchor" aria-label="anchor" href="#arg-featurefilt-value"></a></dt>
<dd><p><em>Optional: </em> Percentage of feature filtering. <strong>Default = 0.8</strong></p></dd>


<dt id="arg-tic">TIC<a class="anchor" aria-label="anchor" href="#arg-tic"></a></dt>
<dd><p><em>Optional: </em> If TRUE, Total Ion Count normalization is performed. <strong>Default = TRUE</strong></p></dd>


<dt id="arg-mvi">MVI<a class="anchor" aria-label="anchor" href="#arg-mvi"></a></dt>
<dd><p><em>Optional: </em> If TRUE, Missing Value Imputation (MVI) based on half minimum is performed <strong>Default = TRUE</strong></p></dd>


<dt id="arg-mvi-percentage">MVI_Percentage<a class="anchor" aria-label="anchor" href="#arg-mvi-percentage"></a></dt>
<dd><p><em>Optional: </em> Percentage 0-100 of imputed value based on the minimum value. <strong>Default = 50</strong></p></dd>


<dt id="arg-hotellinsconfidence">HotellinsConfidence<a class="anchor" aria-label="anchor" href="#arg-hotellinsconfidence"></a></dt>
<dd><p><em>Optional: </em> Defines the Confidence of Outlier identification in HotellingT2 test. Must be numeric.<strong>Default = 0.99</strong></p></dd>


<dt id="arg-core">CoRe<a class="anchor" aria-label="anchor" href="#arg-core"></a></dt>
<dd><p><em>Optional: </em> If TRUE, a consumption-release experiment has been performed and the CoRe value will be calculated. Please consider providing a Normalisation factor column called "CoRe_norm_factor" in your "Input_SettingsFile" DF, where the column "Conditions" matches. The normalisation factor must be a numerical value obtained from growth rate that has been obtained from a growth curve or growth factor that was obtained by the ratio of cell count/protein quantification at the start point to cell count/protein quantification at the end point.. Additionally control media samples have to be available in the "Input" DF and defined as "CoRe_media" samples in the "Conditions" column in the "Input_SettingsFile" DF. <strong>Default = FALSE</strong></p></dd>


<dt id="arg-saveas-plot">SaveAs_Plot<a class="anchor" aria-label="anchor" href="#arg-saveas-plot"></a></dt>
<dd><p><em>Optional: </em> Select the file type of output plots. Options are svg, png, pdf. If set to NULL, plots are not saved. <strong>Default = svg</strong></p></dd>


<dt id="arg-saveas-table">SaveAs_Table<a class="anchor" aria-label="anchor" href="#arg-saveas-table"></a></dt>
<dd><p><em>Optional: </em> Select the file type of output table. Options are "csv", "xlsx", "txt". If set to NULL, plots are not saved. <strong>Default = "csv"</strong></p></dd>


<dt id="arg-printplot">PrintPlot<a class="anchor" aria-label="anchor" href="#arg-printplot"></a></dt>
<dd><p><em>Optional: </em> If TRUE prints an overview of resulting plots. <strong>Default = TRUE</strong></p></dd>


<dt id="arg-folderpath">FolderPath<a class="anchor" aria-label="anchor" href="#arg-folderpath"></a></dt>
<dd><p><em>Optional:</em> Path to the folder the results should be saved at. <strong>default: NULL</strong></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List with two elements: DF (including all output tables generated) and Plot (including all plots generated)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">Intra</span> <span class="op">&lt;-</span> <span class="fu">MetaProViz</span><span class="fu">::</span><span class="fu"><a href="ToyData.html">ToyData</a></span><span class="op">(</span><span class="st">"IntraCells_Raw"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ResI</span> <span class="op">&lt;-</span> <span class="fu">MetaProViz</span><span class="fu">::</span><span class="fu">PreProcessing</span><span class="op">(</span>InputData<span class="op">=</span><span class="va">Intra</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">49</span><span class="op">:</span><span class="fl">58</span><span class="op">)</span> ,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                 SettingsFile_Sample<span class="op">=</span><span class="va">Intra</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">49</span><span class="op">:</span><span class="fl">58</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                 SettingsInfo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Conditions <span class="op">=</span> <span class="st">"Conditions"</span>, Biological_Replicates <span class="op">=</span> <span class="st">"Biological_Replicates"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> FeatureFiltering: Here we apply the modified 80%-filtering rule that takes the class information (Column `Conditions`) into account, which additionally reduces the effect of missing values (REF: Yang et. al., (2015), doi: 10.3389/fmolb.2015.00004). Filtering value selected: 0.8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3 metabolites where removed: AICAR, FAICAR, SAICAR</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Missing Value Imputation: Missing value imputation is performed, as a complementary approach to address the missing value problem, where the missing values are imputing using the `half minimum value`. REF: Wei et. al., (2018), Reports, 8, 663, doi:https://doi.org/10.1038/s41598-017-19120-0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Total Ion Count (TIC) normalization: Total Ion Count (TIC) normalization is used to reduce the variation from non-biological sources, while maintaining the biological variation. REF: Wulff et. al., (2018), Advances in Bioscience and Biotechnology, 9, 339-351, doi:https://doi.org/10.4236/abb.2018.98022</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Outlier detection: Identification of outlier samples is performed using Hotellin's T2 test to define sample outliers in a mathematical way (Confidence = 0.99 ~ p.val &lt; 0.01) (REF: Hotelling, H. (1931), Annals of Mathematical Statistics. 2 (3), 360–378, doi:https://doi.org/10.1214/aoms/1177732979). HotellinsConfidence value selected: 0.99</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in ggplot2::autoplot(stats::prcomp(as.matrix(InputData), scale. = as.logical(Scaling)),     data = InputPCA, colour = Param_Col, fill = Param_Col, shape = Param_Sha,     size = 3, alpha = 0.8, label = T, label.size = 2.5, label.repel = TRUE,     loadings = as.logical(ShowLoadings), loadings.label = as.logical(ShowLoadings),     loadings.label.vjust = 1.2, loadings.label.size = 2.5, loadings.colour = "grey10",     loadings.label.colour = "grey10"):</span> Objects of class <span style="color: #0000BB;">&lt;prcomp&gt;</span> are not supported by autoplot.</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Have you loaded the required package?</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Media</span> <span class="op">&lt;-</span> <span class="fu">MetaProViz</span><span class="fu">::</span><span class="fu"><a href="ToyData.html">ToyData</a></span><span class="op">(</span><span class="st">"CultureMedia_Raw"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ResM</span> <span class="op">&lt;-</span> <span class="fu">MetaProViz</span><span class="fu">::</span><span class="fu">PreProcessing</span><span class="op">(</span>InputData <span class="op">=</span> <span class="va">Media</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span><span class="op">:</span><span class="fl">45</span><span class="op">)</span> ,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                  SettingsFile_Sample <span class="op">=</span> <span class="va">Media</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span><span class="op">:</span><span class="fl">45</span><span class="op">)</span> ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> ,</span></span>
<span class="r-in"><span>                                  SettingsInfo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Conditions <span class="op">=</span> <span class="st">"Conditions"</span>, Biological_Replicates <span class="op">=</span> <span class="st">"Biological_Replicates"</span>, CoRe_norm_factor <span class="op">=</span> <span class="st">"GrowthFactor"</span>, CoRe_media <span class="op">=</span> <span class="st">"blank"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  CoRe<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For Consumption Release experiment we are using the method from Jain M.  REF: Jain et. al, (2012), Science 336(6084):1040-4, doi: 10.1126/science.1218595.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> FeatureFiltering: Here we apply the modified 80%-filtering rule that takes the class information (Column `Conditions`) into account, which additionally reduces the effect of missing values (REF: Yang et. al., (2015), doi: 10.3389/fmolb.2015.00004). Filtering value selected: 0.8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3 metabolites where removed: N-acetylaspartylglutamate, hypotaurine, S-(2-succinyl)cysteine</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Missing Value Imputation: Missing value imputation is performed, as a complementary approach to address the missing value problem, where the missing values are imputing using the `half minimum value`. REF: Wei et. al., (2018), Reports, 8, 663, doi:https://doi.org/10.1038/s41598-017-19120-0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NA values were found in Control_media samples for metabolites. For metabolites including NAs MVI is performed unless all samples of a metabolite are NA.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Metabolites with high NA load (&gt;20%) in Control_media samples are: dihydroorotate.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Metabolites with only NAs (=100%) in Control_media samples are: hydroxyphenylpyruvate. Those NAs are set zero as we consider them true zeros</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Total Ion Count (TIC) normalization: Total Ion Count (TIC) normalization is used to reduce the variation from non-biological sources, while maintaining the biological variation. REF: Wulff et. al., (2018), Advances in Bioscience and Biotechnology, 9, 339-351, doi:https://doi.org/10.4236/abb.2018.98022</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in ggplot2::autoplot(stats::prcomp(as.matrix(InputData), scale. = as.logical(Scaling)),     data = InputPCA, colour = Param_Col, fill = Param_Col, shape = Param_Sha,     size = 3, alpha = 0.8, label = T, label.size = 2.5, label.repel = TRUE,     loadings = as.logical(ShowLoadings), loadings.label = as.logical(ShowLoadings),     loadings.label.vjust = 1.2, loadings.label.size = 2.5, loadings.colour = "grey10",     loadings.label.colour = "grey10"):</span> Objects of class <span style="color: #0000BB;">&lt;prcomp&gt;</span> are not supported by autoplot.</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Have you loaded the required package?</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christina Schmidt, Dimitrios Prymidis, Denes Turei, Macabe Daley, Julio Saez-Rodriguez, Christian Frezza.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

